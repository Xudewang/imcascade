

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>In-depth example &mdash; imcascade 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced" href="adv_guide.html" />
    <link rel="prev" title="Quickstart guide" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> imcascade
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">In-depth example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Setting-up">Setting up</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Modelling-the-PSF">Modelling the PSF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Organizing-all-the-inputs">Organizing all the inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Choosing-the-widths-for-the-Gaussian-components">Choosing the widths for the Gaussian components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Running-imcascade">Running <code class="docutils literal notranslate"><span class="pre">imcascade</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Least-squares-minimization">Least squares-minimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Posterior-estimation">Posterior estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Analyzing-the-results">Analyzing the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adv_guide.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">imcascade</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>In-depth example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/example.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 0;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="In-depth-example">
<h1>In-depth example<a class="headerlink" href="#In-depth-example" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we will be going through an example of running <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> in a realistic setting and discussing issues along the way</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Load all neccesary packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sep</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
</pre></div>
</div>
</div>
<p>For this example we will be running <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> on HSC data on a MW mass galaxy at z=0.25. The data is attained in the cell below and is retrieved using the <code class="docutils literal notranslate"><span class="pre">unagi</span></code> python package availible <a class="reference external" href="%3Chttps://github.com/dr-guangtou/unagi">here</a>, written by Song Huang. The cell below is used to download the data and the PSF</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">unagi</span> <span class="kn">import</span> <span class="n">hsc</span>
<span class="kn">from</span> <span class="nn">unagi.task</span> <span class="kn">import</span> <span class="n">hsc_psf</span><span class="p">,</span><span class="n">hsc_cutout</span>
<span class="n">pdr2</span> <span class="o">=</span> <span class="n">hsc</span><span class="o">.</span><span class="n">Hsc</span><span class="p">(</span><span class="n">dr</span><span class="o">=</span><span class="s1">&#39;pdr2&#39;</span><span class="p">,</span><span class="n">rerun</span> <span class="o">=</span> <span class="s1">&#39;pdr2_wide&#39;</span><span class="p">)</span>

<span class="c1">#Downloaded from HSC archive, this a MW mass galaxy at z~0.25 at the sky location below</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span> <span class="o">=</span> <span class="mf">219.36054754</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.40994375</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">examp_coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span> <span class="o">=</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">dec</span><span class="p">)</span>
<span class="n">cutout</span> <span class="o">=</span> <span class="n">hsc_cutout</span><span class="p">(</span><span class="n">examp_coord</span><span class="p">,</span> <span class="n">cutout_size</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">archive</span> <span class="o">=</span> <span class="n">pdr2</span><span class="p">,</span> <span class="n">dr</span> <span class="o">=</span> <span class="s1">&#39;pdr2&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_output</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">hsc_psf</span><span class="p">(</span><span class="n">examp_coord</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">archive</span><span class="o">=</span><span class="n">pdr2</span><span class="p">,</span> <span class="n">save_output</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1">#Retrieve science and variance images</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cutout</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">cutout</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
<span class="n">psf_data</span> <span class="o">=</span> <span class="n">psf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Get table list from /home/tim/anaconda3/envs/imc/lib/python3.9/site-packages/unagi/data/pdr2_wide/pdr2_wide_tables.fits
# Retrieving cutout image in filter: i
# Retrieving coadd PSF model in filter: i
</pre></div></div>
</div>
<div class="section" id="Setting-up">
<h2>Setting up<a class="headerlink" href="#Setting-up" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Modelling-the-PSF">
<h3>Modelling the PSF<a class="headerlink" href="#Modelling-the-PSF" title="Permalink to this headline">¶</a></h3>
<p>To use <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> while accounting for the PSF, you need to have a Gaussian decomposition of the PSF. While this is availible for some surveys, you can use the <code class="docutils literal notranslate"><span class="pre">imcascade.psf_fitter</span></code> module to help if you have a pixelized version.</p>
<p>The following function first fits the PSF profile in 1D to decide what the best widths are. Then a 2D fit is used to find the correct weights</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">imcascade.psf_fitter</span> <span class="kn">import</span> <span class="n">PSFFitter</span>
<span class="n">psf_fitter</span> <span class="o">=</span> <span class="n">PSFFitter</span><span class="p">(</span><span class="n">psf_data</span><span class="p">)</span>
<span class="n">psf_sig</span><span class="p">,</span><span class="n">psf_a</span><span class="p">,</span><span class="n">chi2</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">psf_fitter</span><span class="o">.</span><span class="n">fit_N</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Can choose number</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">psf_sig</span><span class="p">,</span><span class="n">psf_a</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.56676938 3.1562418  7.16928138] [0.72289466 0.21654144 0.05830564]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_6_1.png" src="_images/example_6_1.png" />
</div>
</div>
<p>We can see that a model with three gaussians provides a pretty good fit! Generally we find 2-3 components works well for standard ground based telescopes and for more complicated PSFs, like HST WFC3, we find 4 works well. There is some incentive to use a small number of gaussians to define the PSF as it decreasese the time to render a model image. Additionally it is good to check that the sum of the weights, <code class="docutils literal notranslate"><span class="pre">psf_a</span></code>, is close to one. This ensures the PSF, and the fit are properly normalized</p>
</div>
<div class="section" id="Organizing-all-the-inputs">
<h3>Organizing all the inputs<a class="headerlink" href="#Organizing-all-the-inputs" title="Permalink to this headline">¶</a></h3>
<p>First let’s take a quick look at the science and variance images. We will be fitting a model to the science image and the inverse of the variance image will be used as the pixel weights when fitting</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Science Image&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Variance Image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_10_0.png" src="_images/example_10_0.png" />
</div>
</div>
<p>Additionally we will be building a mask to mask contaminating sources that we don’t want affecting the fit</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Use sep to detect sources</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">Background</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">x_cent</span><span class="p">,</span><span class="n">y_cent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">obj</span><span class="p">,</span><span class="n">seg</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">img</span> <span class="o">-</span> <span class="n">bkg</span><span class="o">.</span><span class="n">back</span><span class="p">(),</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="n">deblend_cont</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span><span class="n">segmentation_map</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">seg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">seg</span> <span class="o">==</span> <span class="n">seg</span><span class="p">[</span><span class="n">x_cent</span><span class="p">,</span><span class="n">y_cent</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mask_raw</span> <span class="o">=</span> <span class="n">seg</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1">#Convolve mask with a gaussian to expand it and make sure that all low-SB emission is masked</span>
<span class="kn">from</span> <span class="nn">imcascade.utils</span> <span class="kn">import</span> <span class="n">expand_mask</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">expand_mask</span><span class="p">(</span><span class="n">mask_raw</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mask&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Masked, Streched, Science Image&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_12_0.png" src="_images/example_12_0.png" />
</div>
</div>
</div>
<div class="section" id="Choosing-the-widths-for-the-Gaussian-components">
<h3>Choosing the widths for the Gaussian components<a class="headerlink" href="#Choosing-the-widths-for-the-Gaussian-components" title="Permalink to this headline">¶</a></h3>
<p>The next major decision is what set of widths to use for the Gaussian components. In general we reccomend logarithmically spaced widths. This means there are more components are smaller radii where the signal is the largest and the profile changes the quickest. asinh scaling can also work.</p>
<p>Next we have to choose start and end points. This should be 0.5-1 pixel (or half the PSF width) to roughly 10 times the effective radius. The estimate of the effective radius does not need to be accurate, for example the Kron radius for sep or Sextractor works well. This should help decide the size of the cutout too. In order to properly model the sky the cutoutsize should be at least 3-4 times larger then the largest width, so 30-40 times the effective radius.</p>
<p>Finally we have to choose the number of components. In our testing somewhere around 9-11 seems to work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These decisions are not trivial and can affect on the outcome of an <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> fit. However reasonable changes withn the confines discussed here shouldn’t greatly affect the results. You should run tests to ensure you have chosen a reliable set of widths. If the results are very sensitive to the choice of widths, you should be wary and there may be other issues at play.</p>
</div>
<p>In this example we estimate the effective radius to be roughly 6 pixels so we use 9 components with logarithmically spaced widths from 1 pixels to 60 pixels (~10 x r eff) and use a cutout size of 240 pixels, roughly 40 times the effective radius.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also specify inital conditions to help make inital guesses. Here we specify the estimated half light radii and total flux. The code make some intelligent guesses on the inital conditions and the bounds but this may help ensure a quick and reliable fit. It is also possible to specify guessea and bounds for individual components, sky values etc. but this is more involved. See the user’s guide for more details</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">init_dict</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;re&#39;</span><span class="p">:</span><span class="mf">6.</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="mf">1000.</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Running-imcascade">
<h2>Running <code class="docutils literal notranslate"><span class="pre">imcascade</span></code><a class="headerlink" href="#Running-imcascade" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Least-squares-minimization">
<h3>Least squares-minimization<a class="headerlink" href="#Least-squares-minimization" title="Permalink to this headline">¶</a></h3>
<p>To run imcascade we first need to intialize a <code class="docutils literal notranslate"><span class="pre">Fitter</span></code> instance with all the inputs discussed above. This class organizes all the data and contains all the methods used to fit the image</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">imcascade</span> <span class="kn">import</span> <span class="n">Fitter</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">Fitter</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span> <span class="n">psf_sig</span><span class="p">,</span> <span class="n">psf_a</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">var</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> <span class="n">init_dict</span> <span class="o">=</span> <span class="n">init_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can run least squares minimization using the command below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">min_res</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">run_ls_min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 20:36:43,157 - Running least squares minimization
2021-05-13 20:38:30,496 - Finished least squares minimization
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## Let&#39;s take a quick look at the best fit-model to make sure it looks god</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">best_fit_mod</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">make_model</span><span class="p">(</span><span class="n">min_res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">#generate a model image using the best fitting parameters</span>

<span class="c1">#Calculate the residual image and mask out the other sources</span>
<span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">fitter</span><span class="o">.</span><span class="n">img</span> <span class="o">-</span> <span class="n">best_fit_mod</span><span class="p">)</span><span class="o">/</span><span class="n">best_fit_mod</span>
<span class="n">resid</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">fitter</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fitter</span><span class="o">.</span><span class="n">img</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">mask</span><span class="p">)),</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Best Fit Model&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">best_fit_mod</span><span class="p">),</span><span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;seismic&#39;</span><span class="p">)</span>
<span class="c1">#ax3.set_xlim([50,150])</span>
<span class="c1">#ax3.set_ylim([150,50])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&lt;ipython-input-10-0baef58ef498&gt;:11: RuntimeWarning: divide by zero encountered in log10
  ax1.imshow(np.log10(fitter.img*np.logical_not(mask)),vmin = -2, vmax =1)
&lt;ipython-input-10-0baef58ef498&gt;:11: RuntimeWarning: invalid value encountered in log10
  ax1.imshow(np.log10(fitter.img*np.logical_not(mask)),vmin = -2, vmax =1)
&lt;ipython-input-10-0baef58ef498&gt;:13: RuntimeWarning: invalid value encountered in log10
  ax2.imshow(np.log10(best_fit_mod),vmin = -2, vmax =1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_23_1.png" src="_images/example_23_1.png" />
</div>
</div>
<p>While there are some asymmetric features that can’t be described by axisymmetric model the fit overall looks pretty good.</p>
<p>The best fit parameters can be also be accessed,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fitter</span><span class="o">.</span><span class="n">min_res</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 1.20223935e+02,  1.18955020e+02,  9.11389736e-01,  2.29045943e+00,
        2.20705720e+00, -1.99999780e+00,  2.13000341e+00,  2.55817400e+00,
        2.85057953e+00, -1.99999911e+00,  1.45816601e+00, -1.99999969e+00,
       -1.99999998e+00,  7.07456398e-03, -1.16053899e-04, -2.28207981e-05])
</pre></div></div>
</div>
<p>They are, in order, <span class="math notranslate nohighlight">\(x_0\)</span>,<span class="math notranslate nohighlight">\(y_0\)</span>, axis ratio and position angle. Than the next 9 values are the best fit weights for the Gaussian components. Note that by default <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> explores these in log scale. This can be changes by passing the option <code class="docutils literal notranslate"><span class="pre">log_weight_scale</span> <span class="pre">=</span> <span class="pre">False</span></code> when intializing. The final three parameters describe the best fit tilted-plane sky model. The can also be disabled when intializing with <code class="docutils literal notranslate"><span class="pre">sky_model</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p>
<p>These aren’t super easy to parase as is, which is why we using the <code class="docutils literal notranslate"><span class="pre">ImcascadeResults</span></code> class discussed below.</p>
</div>
<div class="section" id="Posterior-estimation">
<h3>Posterior estimation<a class="headerlink" href="#Posterior-estimation" title="Permalink to this headline">¶</a></h3>
<p>Below we show the commands that could be used to use Bayesian techniques to explore the posterior distributions. Specifically we are using the method discussed in the paper based on pre-rendered images. There are additional options when running <code class="docutils literal notranslate"><span class="pre">dynesty</span></code> using <code class="docutils literal notranslate"><span class="pre">imcascade</span></code>. Specifically we offer two choices of priors, the default is based on the results of the least-squares minimization, the other being uniform priors. We found the former runs quicker and more reliably as the priors are not
as broad. It is also possible to set you own priors, see the Advanced section for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span>  <span class="n">fitter</span><span class="o">.</span><span class="n">run_dynesty</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;express&#39;</span><span class="p">)</span>
<span class="o">&gt;</span>  <span class="n">fitter</span><span class="o">.</span><span class="n">save_results</span><span class="p">(</span><span class="s1">&#39;./examp_results.asdf&#39;</span><span class="p">,</span> <span class="n">run_basic_analysis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This is much quicker than the traditional method. However it still took about 30 min to run on my laptop. So I have run it previously and we will load the saved data.</p>
</div>
</div>
<div class="section" id="Analyzing-the-results">
<h2>Analyzing the results<a class="headerlink" href="#Analyzing-the-results" title="Permalink to this headline">¶</a></h2>
<p>Since when using <code class="docutils literal notranslate"><span class="pre">imcascade</span></code> the paramters that are fit are the fluxes of each Gaussian component, the analysis is more involved then other parameterized models, which fit directly for the total flux, radius etc. To assist in this we have written the <code class="docutils literal notranslate"><span class="pre">results</span></code> module and the <code class="docutils literal notranslate"><span class="pre">ImcascadeResults</span></code> class. This class can be initialized multiple ways. First you can pass it a <code class="docutils literal notranslate"><span class="pre">Fitter</span></code> instance after running <code class="docutils literal notranslate"><span class="pre">run_ls_min()</span></code> and/or <code class="docutils literal notranslate"><span class="pre">run_dynesty()</span></code>. Alternatively it can be passed a string which
denotes the location of an ASDF file of the saved results</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">imcascade</span> <span class="kn">import</span> <span class="n">ImcascadeResults</span>

<span class="c1">#Initialized using fitter instance</span>
<span class="n">ls_res</span> <span class="o">=</span> <span class="n">ImcascadeResults</span><span class="p">(</span><span class="n">fitter</span><span class="p">)</span>

<span class="c1">#Initialized with saved file</span>
<span class="n">dyn_res</span> <span class="o">=</span> <span class="n">ImcascadeResults</span><span class="p">(</span><span class="s1">&#39;examp_results.asdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ImcascadeResults</span></code> will default to using the posterior to derrive morphological parameters if it is availible. For <code class="docutils literal notranslate"><span class="pre">ls_res</span></code> since we did not run any bayesian method, it will use the best fit parameters. Note that without a bayesian method no measurement errors will be displayed.</p>
<p>There are a number of functions we have written to calculate various morpological quantities, please see the API reference for all functions. For a lot of applications, one can simple run <code class="docutils literal notranslate"><span class="pre">run_basic_analysis()</span></code> which calculates a series of common morpological quantities</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#For ls_res we can see there are no error bars. By specifying a zpt, we can also calculate the total magnitude</span>
<span class="n">ls_res</span><span class="o">.</span><span class="n">run_basic_analysis</span><span class="p">(</span><span class="n">zpt</span> <span class="o">=</span> <span class="mi">27</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;flux&#39;: 1395.1876996629685,
 &#39;mag&#39;: 19.138418403118877,
 &#39;r20&#39;: 2.456984739872308,
 &#39;r50&#39;: 6.239519164395292,
 &#39;r80&#39;: 11.467785253840017,
 &#39;r90&#39;: 14.788535289120016,
 &#39;C80_20&#39;: 4.667422254497197,
 &#39;C90_50&#39;: 2.3701402142505095}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#we can also specify the percentiles used to calculate the error bars, here we use the 5th-95th percentile</span>
<span class="n">dyn_res</span><span class="o">.</span><span class="n">run_basic_analysis</span><span class="p">(</span><span class="n">zpt</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span> <span class="n">errp_lo</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">errp_hi</span> <span class="o">=</span> <span class="mi">95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;flux&#39;: array([1392.29598627,    7.78567762,    8.19996072]),
 &#39;mag&#39;: array([1.91406711e+01, 6.37571292e-03, 6.08844357e-03]),
 &#39;r20&#39;: array([2.45204514, 0.01664059, 0.01731346]),
 &#39;r50&#39;: array([6.22609692, 0.03780477, 0.03971284]),
 &#39;r80&#39;: array([11.42816133,  0.10914675,  0.11617468]),
 &#39;r90&#39;: array([14.71305841,  0.21685708,  0.2334946 ]),
 &#39;C80_20&#39;: array([4.66072506, 0.02801944, 0.02844901]),
 &#39;C90_50&#39;: array([2.36328208, 0.02271715, 0.02335112])}
</pre></div></div>
</div>
<p>In addition to these integrated quantities, we can calculate the surface brightness profile and curve-of-growth as a function of semi-major axis</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Sets of radii to calculate profiles at</span>
<span class="n">rplot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">sbp_ls_tot</span> <span class="o">=</span> <span class="n">ls_res</span><span class="o">.</span><span class="n">calc_sbp</span><span class="p">(</span><span class="n">rplot</span><span class="p">)</span>

<span class="c1"># Using return_ind we return the contributions of each individual gaussian component</span>
<span class="n">sbp_ls_ind</span> <span class="o">=</span> <span class="n">ls_res</span><span class="o">.</span><span class="n">calc_sbp</span><span class="p">(</span><span class="n">rplot</span><span class="p">,</span><span class="n">return_ind</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you use <code class="docutils literal notranslate"><span class="pre">dyn_res</span></code> where the postior distribution is availible it will return a 2D array containing the SBP of each sample of the posterior.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Here we will calculate the posterier distribution of the surface_brightness profile</span>
<span class="n">sbp_all</span> <span class="o">=</span> <span class="n">dyn_res</span><span class="o">.</span><span class="n">calc_sbp</span><span class="p">(</span><span class="n">rplot</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">sbp_all</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">#Here we calculate the curve-of-growth for the posterier</span>
<span class="n">cog_all</span> <span class="o">=</span> <span class="n">dyn_res</span><span class="o">.</span><span class="n">calc_cog</span><span class="p">(</span><span class="n">rplot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(200, 25970)
</pre></div></div>
</div>
<p>Now we plot both, the red lines show the individual components from the least squares solution and all the black lines show individual samples from the posterior</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rplot</span><span class="p">,</span> <span class="n">sbp_all</span><span class="p">[:,::</span><span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rplot</span><span class="p">,</span> <span class="n">sbp_ls_ind</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">5e-4</span><span class="p">,</span><span class="mf">5e1</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Surface Brightness Profile&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius (pixels)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rplot</span><span class="p">,</span><span class="n">cog_all</span><span class="p">[:,::</span><span class="mi">100</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Curve-of-growth&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius (pixels)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$F(&lt;R)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_38_0.png" src="_images/example_38_0.png" />
</div>
</div>
<p>If you are interested in morphological quantity that is not included, it is likely that it will be easy to calculate and code up, so please contact us!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="adv_guide.html" class="btn btn-neutral float-right" title="Advanced" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Tim Miller &amp; Pieter van Dokkum.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>